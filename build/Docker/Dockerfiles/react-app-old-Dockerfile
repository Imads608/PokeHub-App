FROM app-base-image:latest AS builder
WORKDIR /app/builder
COPY . .
RUN npx nx build react-app --configuration=production

FROM node:lts-alpine3.10
WORKDIR /app
COPY --from=builder /app/builder/apps/react-app/package.json .
COPY --from=builder /app/builder/dist/apps/react-app .
RUN npm install --only=production
RUN npm install -g serve
EXPOSE 3000
CMD ["serve"]
