properties:
  environmentId: /subscriptions/fc24fb67-c494-48a0-b6af-3075eeb257fc/resourceGroups/pokehub_group/providers/Microsoft.App/managedEnvironments/pokehub-env
  configuration:
    activeRevisionsMode: Single
    ingress:
      external: true
      targetPort: 3000
      transport: auto
      allowInsecure: false
    registries:
      - server: pokehub.azurecr.io
        username: pokehub
        passwordSecretRef: acr-password
    secrets:
      - name: acr-password
        value: REPLACE_WITH_ACR_PASSWORD
      - name: db-host
        value: REPLACE_WITH_DB_HOST
      - name: db-port
        value: REPLACE_WITH_DB_PORT
      - name: db-name
        value: REPLACE_WITH_DB_NAME
      - name: db-user
        value: REPLACE_WITH_DB_USER
      - name: db-password
        value: REPLACE_WITH_DB_PASSWORD
      - name: google-client-id
        value: REPLACE_WITH_GOOGLE_CLIENT_ID
      - name: refresh-token-secret
        value: REPLACE_WITH_REFRESH_TOKEN_SECRET
      - name: access-token-secret
        value: REPLACE_WITH_ACCESS_TOKEN_SECRET
  template:
    containers:
      - name: pokehub-api
        image: pokehub.azurecr.io/pokehub-api:latest
        resources:
          cpu: 1.0
          memory: 2Gi
        env:
          - name: NODE_ENV
            value: production
          - name: DB_HOST
            secretRef: db-host
          - name: DB_PORT
            secretRef: db-port
          - name: DB_NAME
            secretRef: db-name
          - name: DB_USER
            secretRef: db-user
          - name: DB_PASS
            secretRef: db-password
          - name: PORT
            value: '3000'
          - name: ACCESS_TOKEN
            secretRef: access-token-secret
          - name: ACCESS_TOKEN_EXPIRES
            value: '60'
          - name: REFRESH_TOKEN
            secretRef: refresh-token-secret
          - name: REFRESH_TOKEN_EXPIRES
            value: '720'
          - name: AZURE_STORAGE_ACCOUNT
            value: 'pokehub'
          - name: AZURE_STORAGE_CONTAINER
            value: 'avatars'
          - name: GOOGLE_CLIENT_ID
            secretRef: google-client-id
    scale:
      minReplicas: 1
      maxReplicas: 3
